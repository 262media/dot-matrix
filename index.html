<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Dot MatrixðŸ”¥</title>
        <link href="https://fonts.googleapis.com/css?family=Cutive+Mono&display=swap" rel="stylesheet">
        <link href="demo.css" rel="stylesheet">
    </head>
    <body>
        <div class="controls">
            <p>Dot Count: <span class="count"></span></p>

            <label for="spacing">spacing
                <input type="range" min="0" max="1000" name="spacing" placeholder="spacing" value="30"/>
            </label>

            <label for="padding">padding
                <input type="range" min="0" name="padding" placeholder="padding" value="50"/>
            </label>

            <label for="delay">delay
                <input type="range" min="0" max="10000" name="delay" placeholder="delay" value="200"/>
            </label>

            <label for="step-distance">step distance
                <input type="range" min="10" max="1000" name="step-distance" placeholder="step distance" value="10"/>
            </label>

            <label for="fear-distance">fear distance
                <input type="range" min="0" max="1000" name="fear-distance" placeholder="fear distance" value="100"/>
            </label>

            <label for="dotRadius">dotRadius
                <input type="range" min="1" name="dotRadius" placeholder="dotRadius" value="5"/>
            </label>

            <label for="dotFillColor">dotFillColor
                <input type="text" name="dotFillColor" placeholder="HEX or string" value=""/>
            </label>
            <br>
            <p>Example</p>
            <button class="moderate_dots_spacing">Small Dots</button>
            <button class="tenK_smalls_dots">10k+ dots BEWARE!</button>
            <button class="spaced_large_dots">Large Dots</button>
            <button class="spaced_medium_dots">Medium Dots</button>
            <button class="dense_group">Dense Group </button>
            <br>
            <p>Config Object(In JSON)</p>
            <pre class="config"></pre>
        </div>
        <div class="wrapper">
            <h1>Dot Matrix</h1>
            <svg class="dot-matrix" width="100%" height="100%"></svg>
        </div>
        <script src="coordinate-translator.js"></script>
        <script src="smart-dot.js"></script>
        <script src="dot-matrix.js"></script>
        <script src="examples.js"></script>
        <script src="demo-dimensions.js"></script>
        <script src="controls-listeners.js"></script>
        <script src="mobile-demo.js"></script>
        <script src="clean-class-object.js"></script>
        <script src="control-values.js"></script>
        <script>
            (() => {
                //--------------------------------------------------------
                //--------------------------------------------------------
                // Vars
                const controls = document.querySelector('.controls');
                const wrapper = document.querySelector('.wrapper');
                const svg = document.querySelector('.dot-matrix');
                const count = document.querySelector('.count');
                const config = document.querySelector('.config');

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Mobile Settings
                if (window.innerWidth <= 991) {
                    mobileDemo({
                        svg,
                        controls,
                        wrapper
                    });

                    return false;
                }

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Update size for fullscreen considering the controls
                window.adjustedWidth = demoDimensions();

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Kick it off
                window.matrix = new DotMatrix(
                    document.querySelector('.dot-matrix'),
                    {
                        padding: 50,
                        spacing: 30,
                        width: window.adjustedWidth,
                        height: window.innerHeight,
                        distanceToFear: 100,
                        distanceToStep: 10,
                        delayBeforeGoingHome: 200,
                        dotRadius: 5,
                        dotColorPattern: 'diagonal',
                        patternColors: [
                            'red',
                            'orange',
                            'yellow',
                            'green',
                            'cyan',
                            'skyblue',
                            'blue',
                            'indigo',
                            'violet',
                            'lightgray',
                        ],
                        cssClassGoingHome: 'animate_going_home',
                        timing: {
                            fromHome: 'ease',
                            backHome: 'ease',
                        },
                        duration: {
                            fromHome: '0.1s',
                            backHome: '1s',
                        },
                    }
                );

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Clean class object
                const cleanObject = cleanObjectClass(window.matrix);

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Update Controls
                setControlValues(cleanObject);

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Print initial return object from DotMatrix
                config.innerHTML = JSON.stringify(cleanObject, undefined, 2);
                count.innerHTML = parseInt(cleanObject.rows) * parseInt(cleanObject.columns);

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Adjust wrapper width
                wrapper.style.width = `${window.adjustedWidth}px`;
                wrapper.style.height = `${window.innerHeight}px`;

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Set Controls Listeners
                controlsListeners();

                //--------------------------------------------------------
                //--------------------------------------------------------
                // Custom Event Listener
                document.addEventListener('matrix_reload', (e) => {
                    // Performance
                    e.preventDefault();
                    e.stopPropagation();

                    // Vars from controls
                    const values = getControlValues();

                    wrapper.style.width = `${window.adjustedWidth}px`;
                    wrapper.style.height = `${window.innerHeight}px`;

                    // Old svg
                    const svg = document.querySelector('.dot-matrix');
                    // Remove old svg
                    svg.remove();

                    // Create new svg, add class and append to wrapper
                    const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    newSvg.classList = 'dot-matrix';
                    wrapper.appendChild(newSvg);

                    // Delete old class
                    delete window.matrix
                    // New Config object
                    const configObject = {
                        width: window.adjustedWidth,
                        height: window.innerHeight,
                        padding: values.padding,
                        spacing: values.spacing,
                        dotRadius: values.dotRadius,
                        dotFillColor: values.dotFillColor,
                        dotColorPattern: !!values.dotFillColor ? 'fill' : 'diagonal',
                        distanceToFear: values.distanceToFear,
                        distanceToStep: values.distanceToStep,
                        delayBeforeGoingHome: !!values.delayBeforeGoingHome === false ? false : values.delayBeforeGoingHome,
                        cssClassGoingHome: 'animate_going_home',
                        timing: {
                            fromHome: 'ease',
                            backHome: 'ease',
                        },
                        duration: {
                            fromHome: '0.1s',
                            backHome: '1s',
                        },
                    };

                    // Kick it off
                    window.matrix = new DotMatrix(
                        newSvg,
                        e.detail ? getExampleConfig(e.detail.config, window.adjustedWidth) : configObject,
                    );

                    // Clean object
                    const updatedCleanedObject = cleanObjectClass(window.matrix);

                    // Update control values
                    setControlValues(updatedCleanedObject);

                    // Print config json and update dot count
                    config.innerHTML = JSON.stringify(updatedCleanedObject, undefined, 2);
                    count.innerHTML = parseInt(updatedCleanedObject.rows) * parseInt(updatedCleanedObject.columns);
                });
            })();
        </script>
    </body>
</html>